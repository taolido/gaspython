# 第2章：AIを「プログラミング家庭教師」にする

## この章で学ぶこと

- AIを効果的に学習に活用する方法
- エラーが出たときの対処サイクル
- 依存関係エラーの解決方法
- AIと一緒にツールを作る実践
- GASとPythonの使い分け

---

# 2-1. Claude/ChatGPTの正しい使い方

## 「丸投げ」は学習にならない

AIツールは便利ですが、使い方を間違えると**スキルが身につきません**。

```
┌─────────────────────────────────────────────────────────────┐
│  NGな使い方（丸投げ）                                       │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  あなた：「売上データを集計するコード書いて」               │
│      ↓                                                       │
│  AI：「はい、こちらです」（コードを生成）                   │
│      ↓                                                       │
│  あなた：（コピペして実行）                                  │
│      ↓                                                       │
│  動いた！終わり！                                            │
│                                                              │
│  【問題点】                                                  │
│  ・なぜ動くか理解していない                                 │
│  ・エラーが出たら対処できない                               │
│  ・応用が利かない                                           │
│  ・次も同じことをAIに聞くしかない                          │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

---

## 「理解を深める」使い方

AIを「家庭教師」として活用しましょう。

```
┌─────────────────────────────────────────────────────────────┐
│  OKな使い方（理解を深める）                                 │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  Step 1: 自分でまず考える・書いてみる                       │
│                                                              │
│  Step 2: 分からない部分をピンポイントで質問                 │
│          「groupby()の意味を教えて」                        │
│          「このエラーの原因は？」                           │
│                                                              │
│  Step 3: 回答を理解する                                     │
│          「なぜそうなるの？」と追加質問                     │
│                                                              │
│  Step 4: 理解した上で自分でコードを書く                     │
│                                                              │
│  Step 5: 動作確認・エラーが出たらStep 2に戻る              │
│                                                              │
│  【結果】                                                   │
│  ・「なぜ動くか」を理解している                            │
│  ・エラーにも対処できる                                     │
│  ・応用が利く                                               │
│  ・次は自分で書ける                                         │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

---

## 効果的なプロンプトの書き方

### ポイント1：具体的に質問する

```
悪い例：
「pandasの使い方を教えて」
→ 範囲が広すぎて、一般的な回答しか得られない

良い例：
「pandasのgroupby()で部署ごとの売上合計を計算する方法を、
具体的なコード例で教えてください。
入力データは以下の形式です：日付, 部署, 金額」
→ 自分の状況に合った具体的な回答が得られる
```

### ポイント2：自分のレベルを伝える

```
良い例：
「私はGASは使えますが、Pythonは初心者です。
GASとの違いも含めて説明してください」

→ 適切なレベルの説明が得られる
→ GASとの比較で理解しやすくなる
```

### ポイント3：「なぜ」を聞く

```
良い例：
「このコードは動きましたが、なぜ [] ではなく () を使うのですか？」
「df[df['金額'] > 1000] でフィルタリングできる理由を教えてください」

→ 暗記ではなく理解につながる
```

---

## 実践：AIへの効果的な質問例

### 例1：コードの意味を理解する

**プロンプト：**
```
以下のPythonコードを1行ずつ説明してください。
私はGASは使えますが、Pythonは初心者です。

```python
df = pd.read_excel('売上.xlsx')
result = df.groupby('部署')['金額'].sum()
result.to_excel('集計.xlsx')
```
```

**AIの回答例：**

1行ずつ説明します。

**1行目：**
```python
df = pd.read_excel('売上.xlsx')
```
- `pd` はpandasライブラリの略称（import pandas as pd で定義）
- `read_excel()` はExcelファイルを読み込む関数
- 読み込んだデータは `df`（DataFrameの略）という変数に入る
- GASでいうと `SpreadsheetApp.openById().getSheetByName().getDataRange().getValues()` を1行で行っているイメージ

**2行目：**
```python
result = df.groupby('部署')['金額'].sum()
```
- `groupby('部署')` は「部署」列でグループ化
- `['金額']` は金額列を選択
- `.sum()` は合計を計算
- GASだと以下のように書く必要があるものを、1行で実現：
```javascript
// GASの場合
const result = {};
data.forEach(row => {
  const dept = row[1];
  const amount = row[3];
  result[dept] = (result[dept] || 0) + amount;
});
```

**3行目：**
```python
result.to_excel('集計.xlsx')
```
- 集計結果を新しいExcelファイルとして保存
- GASでいうと、新しいシートを作成してsetValuesするイメージ

---

### 例2：GASコードをPythonに変換

**プロンプト：**
```
以下のGASコードをPythonに変換してください。
また、書き方の違いを説明してください。

```javascript
function filterHighSales() {
  const data = [
    {name: "商品A", price: 1000},
    {name: "商品B", price: 5000},
    {name: "商品C", price: 3000}
  ];

  const highPrice = data.filter(item => item.price >= 3000);
  highPrice.forEach(item => {
    console.log(item.name + ": " + item.price + "円");
  });
}
```
```

**AIの回答例：**

以下がPython版です：

```python
data = [
    {"name": "商品A", "price": 1000},
    {"name": "商品B", "price": 5000},
    {"name": "商品C", "price": 3000}
]

# 方法1: リスト内包表記（Pythonらしい書き方）
high_price = [item for item in data if item["price"] >= 3000]

for item in high_price:
    print(f"{item['name']}: {item['price']}円")
```

**書き方の違い：**

| 項目 | GAS | Python |
|------|-----|--------|
| オブジェクト | `{name: "商品A"}` | `{"name": "商品A"}` |
| フィルタ | `.filter(item => 条件)` | `[item for item in data if 条件]` |
| プロパティアクセス | `item.price` | `item["price"]` |
| ループ | `forEach(item => {})` | `for item in list:` |
| 出力 | `console.log()` | `print()` |
| 文字列結合 | `+ で連結` | `f文字列推奨` |

---

# 2-2. エラーが出たら→AIに聞く→理解する→修正する

## エラー対処の基本サイクル

プログラミングでエラーは避けられません。重要なのは**対処の型を身につける**ことです。

```
┌─────────────────────────────────────────────────────────────┐
│                                                              │
│  エラー対処の4ステップ                                      │
│                                                              │
│  Step 1: エラーメッセージを読む                             │
│          └→ 最後の数行が重要                               │
│                                                              │
│  Step 2: AIに質問する                                       │
│          └→ エラーメッセージ + コードを貼り付け            │
│                                                              │
│  Step 3: 原因を理解する                                     │
│          └→ 「なぜそうなるのか」を把握                     │
│                                                              │
│  Step 4: 自分で修正する                                     │
│          └→ 理解した上でコードを直す                       │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

---

## エラーメッセージの読み方

Pythonのエラーメッセージは「下から読む」のがコツです。

**例：**
```
Traceback (most recent call last):
  File "<stdin>", line 3, in <module>
    result = df.groupby('部署')['売上'].sum()
  File "/usr/local/lib/python3.10/dist-packages/pandas/core/frame.py", line 3761, in __getitem__
    indexer = self.columns.get_loc(key)
  File "/usr/local/lib/python3.10/dist-packages/pandas/core/indexes/base.py", line 3654, in get_loc
    raise KeyError(key)
KeyError: '売上'                    ← ★ ここが一番重要
```

**読み方：**
```
一番下の行 → エラーの種類と内容
            「KeyError: '売上'」 = 「売上」というキーが見つからない

下から2〜3行目 → エラーが発生した場所
               line 3 の df.groupby('部署')['売上'].sum()

上の方 → エラーに至るまでの経緯（最初は無視してOK）
```

---

## AIへのエラー質問テンプレート

```
【状況】
Pythonで以下のエラーが出ました。原因と解決策を教えてください。

【エラーメッセージ】
```
[エラーメッセージを全文コピペ]
```

【実行したコード】
```python
[コードを全文コピペ]
```

【やりたかったこと】
[何をしようとしていたか]

【環境】
Google Colab / Python 3.x
```

---

## よくあるエラーと対処法

### エラー1: NameError

**メッセージ：**
```
NameError: name 'pd' is not defined
```

**原因：** pandasをインポートしていない、またはインポートしたセルを実行していない

**解決：**
```python
import pandas as pd  # ← これを最初に実行
```

### エラー2: KeyError

**メッセージ：**
```
KeyError: '売上'
```

**原因：** 指定した列名が存在しない

**解決：**
```python
# まず列名を確認
print(df.columns.tolist())
# 出力: ['日付', '部署', '金額']  ← 「売上」ではなく「金額」だった

# 正しい列名を使う
result = df.groupby('部署')['金額'].sum()
```

### エラー3: FileNotFoundError

**メッセージ：**
```
FileNotFoundError: [Errno 2] No such file or directory: '売上.xlsx'
```

**原因：** Colabにファイルをアップロードしていない

**解決：**
```python
from google.colab import files
uploaded = files.upload()  # ← アップロードダイアログが出る
```

### エラー4: TypeError

**メッセージ：**
```
TypeError: can only concatenate str (not "int") to str
```

**原因：** 文字列と数値を+で連結しようとした

**解決：**
```python
# NGなコード
message = "金額: " + 1000 + "円"

# OKなコード
message = f"金額: {1000}円"  # f文字列を使う
```

### エラー5: IndentationError

**メッセージ：**
```
IndentationError: expected an indented block
```

**原因：** if文やfor文の後にインデントがない

**解決：**
```python
# NGなコード
if score >= 60:
print("合格")

# OKなコード
if score >= 60:
    print("合格")  # ← 4スペースのインデント
```

---

# 2-3. 依存関係エラーもAIに聞ける時代

## 環境系エラーの対処法

Pythonを使い続けると、いつか「依存関係エラー」に出会います。

**例：**
```
ERROR: Cannot install package-A==1.0 and package-B==2.0 because
these package versions have conflicting dependencies.
```

従来は、こういうエラーを解決するのに何時間もかかることがありました。
**AI時代は、AIに聞けば解決策が見つかります。**

---

## 依存関係エラーの質問テンプレート

```
【状況】
pip installでエラーが出ました。解決策を教えてください。

【コマンド】
pip install pandas openpyxl xlrd

【エラーメッセージ】
```
[エラーメッセージを全文コピペ]
```

【環境】
・Google Colab
・Python 3.10
・現在インストール済みのパッケージは以下です：
[!pip list の出力を貼り付け]
```

---

## 環境問題を避けるTips

### Tip 1: Colabを使う

Colabならセッションをリセットすれば環境が元に戻ります。
**壊しようがない**のがColabの最大のメリットです。

### Tip 2: 必要最小限のインストール

```python
# NGな例：とりあえず全部入れる
!pip install pandas numpy scipy matplotlib seaborn sklearn tensorflow keras

# OKな例：今必要なものだけ
!pip install pandas openpyxl
```

### Tip 3: バージョンを固定する

```python
# バージョン指定なし（最新版が入る）
!pip install pandas

# バージョン指定あり（特定のバージョンが入る）
!pip install pandas==2.0.3
```

---

# 2-4. 【実践】AIと一緒に簡単なツールを作ってみる

## お題：売上データを集計するツール

AIを「家庭教師」として活用しながら、実際にツールを作ってみましょう。

### Step 1: 要件を整理する

```
【作りたいもの】
売上データから部署別の売上を集計するツール

【入力】
売上データ.xlsx
- 列構成: 日付, 部署, 商品名, 金額

【出力】
・部署別の売上合計を画面に表示
・結果をExcelファイルに保存
```

### Step 2: AIに最初の質問

**プロンプト：**
```
【依頼】
PythonでExcelファイルの売上データを読み込み、
部署別の売上合計を計算するコードを書いてください。

【入力ファイル】
売上データ.xlsx
- 列: 日付, 部署, 商品名, 金額

【出力】
- 部署別の売上合計を表示
- 結果を「集計結果.xlsx」に保存

【環境】
Google Colab

【追加の要望】
- コードには日本語でコメントを入れてください
- 各行の意味を簡単に説明してください
```

**AIの回答例：**

```python
# ===== 売上集計ツール =====
import pandas as pd
from google.colab import files

# ----- Step 1: ファイルをアップロード -----
print("売上データ.xlsxをアップロードしてください")
uploaded = files.upload()  # アップロードダイアログを表示

# ----- Step 2: データを読み込む -----
df = pd.read_excel('売上データ.xlsx')  # Excelを読み込み、DataFrameに
print(f"\n読み込み完了: {len(df)}件のデータ")
print(df.head())  # 最初の5行を表示して確認

# ----- Step 3: 部署別に集計 -----
result = df.groupby('部署')['金額'].sum()  # 部署でグループ化して合計
result = result.sort_values(ascending=False)  # 売上順にソート

print("\n===== 部署別売上 =====")
print(result)

# ----- Step 4: 結果を保存 -----
result.to_excel('集計結果.xlsx')  # Excelに保存
print("\n集計結果.xlsx に保存しました")

# ----- Step 5: ダウンロード -----
files.download('集計結果.xlsx')
```

### Step 3: コードを理解する

**分からない部分を質問：**

```
上のコードの以下の部分の意味を詳しく教えてください：
df.groupby('部署')['金額'].sum()

特に、なぜ [] を2回使うのかが分かりません。
```

**AIの回答例：**

`df.groupby('部署')['金額'].sum()` を分解して説明します：

```python
df.groupby('部署')    # ①部署でグループ化
              ['金額']  # ②金額列を選択
                    .sum()  # ③合計を計算
```

**① df.groupby('部署')**
DataFrameを「部署」列の値でグループ分けします。

```
元のデータ:
   部署    金額
0  営業部  10000
1  開発部  20000
2  営業部  15000
3  開発部   5000

groupby('部署') で:
・営業部グループ: 10000, 15000
・開発部グループ: 20000, 5000
```

**② ['金額']**
グループ化したデータから、「金額」列だけを取り出します。

```
・営業部グループの金額: [10000, 15000]
・開発部グループの金額: [20000, 5000]
```

**③ .sum()**
各グループの合計を計算します。

```
・営業部: 10000 + 15000 = 25000
・開発部: 20000 + 5000 = 25000

結果:
部署
営業部    25000
開発部    25000
```

**なぜ [] を2回使うのか：**
- 1回目の `df.groupby('部署')` の後はGroupByオブジェクト
- 2回目の `['金額']` でその中から金額列を選択
- 両方とも「データを選択する」操作なので `[]` を使う

### Step 4: 実行してエラーが出たら

**もしエラーが出たら：**

```
【状況】
上のコードを実行したら、以下のエラーが出ました。

【エラー】
KeyError: '金額'

【コード】
result = df.groupby('部署')['金額'].sum()
```

**AIの回答例：**

このエラーは「金額」という列がDataFrameに存在しないことを意味します。

**確認方法：**
```python
# 実際の列名を確認
print(df.columns.tolist())
```

**よくある原因：**
1. 列名が違う（「金額」ではなく「売上金額」など）
2. 列名に空白が含まれている（「金額 」など）

**対処法：**
```python
# 列名を確認してから、正しい列名を使う
print(df.columns.tolist())  # ['日付', '部署', '商品名', '売上金額']

# 正しい列名で実行
result = df.groupby('部署')['売上金額'].sum()
```

### Step 5: 動作確認

コードが動いたら、以下を確認しましょう：

```python
# 1. データが正しく読み込まれているか
print(df.head())

# 2. 列名は期待通りか
print(df.columns.tolist())

# 3. 集計結果は正しそうか
print(result)

# 4. ファイルが保存されたか
# → ダウンロードされたファイルをExcelで開いて確認
```

---

## 学びを定着させるポイント

1. **コピペで終わらない** - 各行の意味を理解してから次に進む
2. **分からなければ聞く** - 「なぜ」を聞くことで理解が深まる
3. **自分で書き直す** - AIの回答を見た後、自分で最初から書いてみる
4. **応用してみる** - 「月別集計も追加してみよう」など、自分で拡張する

---

# 2-5. GASとPythonの使い分けチャート

## いつGASを使い、いつPythonを使うか

両方使えるようになると、「どちらを使うべきか」という判断が必要になります。

### 判断フローチャート

```
┌─────────────────────────────────────────────────────────────┐
│                                                              │
│  [質問1] 主にGoogleスプレッドシートを操作する？             │
│                                                              │
│      Yes → GAS推奨                                          │
│             ・SpreadsheetAppで直接操作                      │
│             ・トリガーで定期実行可能                        │
│             ・URL共有が容易                                  │
│                                                              │
│      No → [質問2へ]                                         │
│                                                              │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  [質問2] 大量データ処理や複雑な計算が必要？                 │
│                                                              │
│      Yes → Python推奨                                       │
│             ・pandasで高速処理                               │
│             ・6分制限なし                                    │
│             ・10万行以上でも余裕                            │
│                                                              │
│      No → [質問3へ]                                         │
│                                                              │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  [質問3] Excelファイルを操作する？                          │
│                                                              │
│      Yes → Python推奨                                       │
│             ・openpyxl, pandasで直接操作                    │
│             ・ローカルファイルを扱いやすい                  │
│                                                              │
│      No → [質問4へ]                                         │
│                                                              │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  [質問4] 非エンジニアに共有・配布する？                     │
│                                                              │
│      Yes（Google環境）→ GAS推奨                            │
│             ・URL共有でアクセス                              │
│             ・インストール不要                               │
│                                                              │
│      Yes（ローカル実行）→ Python推奨                       │
│             ・exe化して配布                                  │
│             ・ダブルクリックで実行                           │
│                                                              │
│      No → どちらでもOK                                      │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

---

## 比較表

| 項目 | GAS | Python |
|------|-----|--------|
| **環境構築** | 不要 | 必要（Colabなら不要） |
| **Googleサービス連携** | 非常に簡単 | gspreadで可能 |
| **Excel操作** | やや面倒 | 非常に簡単 |
| **処理速度** | 遅い | 速い |
| **実行時間制限** | 6分 | なし |
| **定期実行** | トリガーで簡単 | タスクスケジューラー必要 |
| **URL共有** | 非常に簡単 | サーバー必要 |
| **exe化** | 不可 | 可能 |
| **データ分析** | 限定的 | pandas, numpy等充実 |
| **学習コスト** | 低い | 中程度 |

---

## ユースケース別おすすめ

### GASがおすすめのケース

```
✓ スプレッドシートの自動化
  例：毎日の売上をシートにまとめる

✓ フォーム回答の処理
  例：アンケート結果を集計する

✓ メール送信の自動化
  例：毎週月曜に週報を送信する

✓ チームでの共有
  例：ボタンを押すと処理が実行されるシートを配布
```

### Pythonがおすすめのケース

```
✓ Excelファイルの一括処理
  例：フォルダ内の100個のExcelを統合

✓ 大量データの分析
  例：10万行の売上データを集計

✓ 複雑なデータ加工
  例：複数条件でのフィルタリングと集計

✓ ローカルでの自動化
  例：毎日PCで自動実行するツール

✓ 非エンジニアへの配布
  例：exe化して「ダブルクリックで実行」
```

### 両方使うケース

```
✓ Excelを処理してスプレッドシートに書き込む
  → PythonでExcel処理 → gspreadでスプレッドシートに出力

✓ スプレッドシートのデータを分析する
  → gspreadでデータ取得 → pandasで分析

✓ 既存のGASスクリプトを活用する
  → PythonからGASのWebAPIを呼び出す
```

---

## この章のまとめ

- AIは「丸投げ」ではなく「理解を深めるパートナー」として使う
- エラーが出たら「エラーメッセージ + コード」をAIに質問
- 依存関係エラーもAIに聞けば解決策が見つかる
- 実践では「自分で考える → AIに聞く → 理解する → 自分で書く」のサイクル
- GASとPythonは用途に応じて使い分ける

### AIへの質問チェックリスト

質問する前に確認しましょう：

- [ ] エラーメッセージを全文コピペしたか
- [ ] 実行したコードを全文コピペしたか
- [ ] やりたかったことを説明したか
- [ ] 環境（Colab/ローカル）を伝えたか
- [ ] 自分のレベルを伝えたか

**次の第3章では、いよいよExcel×Pythonで「目に見える成果」を出します。第1〜2章で学んだ基礎とAI活用法を使って、実用的なツールを作りましょう！**
